# "How to Define a Target for ThetaRush?"

The `target.h` file is used for configuring the source code of ThetaRush, while `target.cmake` is utilized by CMake to configure the entire project automatically. Both of these files are automatically generated by `target.lua`, and manual editing should be strictly avoided to prevent unexpected errors.

To generate `target.h` and `target.cmake` through writing `target.lua`, a properly formatted target.lua should be declared as a `lua module` and follow the following structure:

```lua
local M = {}

M.info = { ... }
M.io = { ... }
M.bus = { ... }

return M
```

## 1."How to Define a Platform?"

To define the platform configuration by creating `M.info` in the specified format:

```lua
M.info = platform.config({
    mcu = "STM32H750xx",
    mcu_series = "STM32H7",
    identifier = "weact_stm32h750vbtx_core_board",
    toolchain = "arm-none-eabi"
})
```

Forced item(s)

- *`info.mcu`* is the mcu of current target
- *`info.mcu_series`* is the series of current mcu, for *STM32H750xx*, it's *STM32H7*
- *`info.identifier`* is the unique identifier of current target
- *`info.toolchain`* is the prefix of cross-compilation for current mcu, for *arm-none-eabi-gcc* is *arm-none-eabi*

Optional item(s)

- None

## 2. "How to Define an IO?"

To define an IO by creating `M.io` in the specified format:

```lua
M.io = {
    io1 = platform.setup(res.all.io, {
        name = "GPIO_OUTPUT_PIN1",
        io = res.io.PE3,
        owner = nil
    }),
}
```

When declaring IO ports in the table, they must follow the `iox` naming convention, where x represents an integer value in the range **1 ≤ x ≤ 16**.

Forced item(s)

- `iox.name` is the name of current IO
- `iox.io` is the io resource of platform, port in range **A to J**, pin in range **0 to 15**

Optional item(s)

- `iox.owner` is the owner of current io, default to `nil`. It won't work for now.
